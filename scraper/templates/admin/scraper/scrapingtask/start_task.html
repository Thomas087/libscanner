{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block title %}{{ title }} | {{ site_title|default:_('Django site admin') }}{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
<a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
&rsaquo; <a href="{% url 'admin:scraper_scrapingtask_changelist' %}">{% trans 'Scraping tasks' %}</a>
&rsaquo; {% trans 'Start New Task' %}
</div>
{% endblock %}

{% block content %}
<h1>{% trans 'Start New Scraping Task' %}</h1>

<form method="post" action="{% url 'admin:scraper_scrapingtask_start' %}">
    {% csrf_token %}
    
    <fieldset class="module aligned">
        <h2>{% trans 'Task Parameters' %}</h2>
        
        <div class="form-row">
            <div>
                <label for="id_keywords">{% trans 'Keywords to search for:' %}</label>
                <div>
                    <input type="text" name="keywords" id="id_keywords" value="bovin,porcin,volaille,poules,pondeuses,poulets" 
                           placeholder="Enter keywords separated by commas" style="width: 100%;" required>
                    <p class="help">{% trans 'Enter keywords separated by commas. Default animal keywords will be used if empty.' %}</p>
                </div>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="id_region_filter">{% trans 'Region filter (optional):' %}</label>
                <div>
                    <input type="text" name="region_filter" id="id_region_filter" 
                           placeholder="e.g., Bretagne, ÃŽle-de-France" style="width: 100%;">
                    <p class="help">{% trans 'Filter by specific region. Leave empty to search all regions.' %}</p>
                </div>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="id_prefecture_filter">{% trans 'Prefecture filter (optional):' %}</label>
                <div>
                    <input type="text" name="prefecture_filter" id="id_prefecture_filter" 
                           placeholder="e.g., Morbihan" style="width: 100%;">
                    <p class="help">{% trans 'Filter by specific prefecture. Leave empty to search all prefectures.' %}</p>
                </div>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="id_output_file">{% trans 'Output file (optional):' %}</label>
                <div>
                    <input type="text" name="output_file" id="id_output_file" 
                           placeholder="e.g., /path/to/results.txt" style="width: 100%;">
                    <p class="help">{% trans 'Optional file path to save results. Leave empty to skip file output.' %}</p>
                </div>
            </div>
        </div>
        
        <div class="form-row">
            <div>
                <label for="id_output_format">{% trans 'Output format:' %}</label>
                <div>
                    <select name="output_format" id="id_output_format" style="width: 200px;">
                        <option value="pretty" selected>{% trans 'Pretty (human-readable)' %}</option>
                        <option value="json">{% trans 'JSON' %}</option>
                    </select>
                    <p class="help">{% trans 'Format for output file (if specified).' %}</p>
                </div>
            </div>
        </div>
    </fieldset>
    
    <div class="submit-row">
        <input type="submit" value="{% trans 'Start Task' %}" class="default" name="start">
        <a href="{% url 'admin:scraper_scrapingtask_changelist' %}" class="button cancel-link">{% trans 'Cancel' %}</a>
    </div>
</form>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-populate keywords field with default values
    const keywordsField = document.getElementById('id_keywords');
    if (!keywordsField.value) {
        keywordsField.value = 'bovin,porcin,volaille,poules,pondeuses,poulets';
    }
    
    // Add some styling
    const form = document.querySelector('form');
    form.style.maxWidth = '800px';
    
    // Add confirmation dialog
    form.addEventListener('submit', function(e) {
        const keywords = document.getElementById('id_keywords').value;
        const region = document.getElementById('id_region_filter').value;
        const prefecture = document.getElementById('id_prefecture_filter').value;
        
        let message = 'Are you sure you want to start this scraping task?\n\n';
        message += 'Keywords: ' + (keywords || 'Default animal keywords') + '\n';
        if (region) message += 'Region: ' + region + '\n';
        if (prefecture) message += 'Prefecture: ' + prefecture + '\n';
        message += '\nThis task may take a long time to complete.';
        
        if (!confirm(message)) {
            e.preventDefault();
        }
    });
});
</script>

<style>
.form-row {
    margin-bottom: 15px;
}

.form-row label {
    font-weight: bold;
    display: block;
    margin-bottom: 5px;
}

.form-row input, .form-row select {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.form-row .help {
    color: #666;
    font-size: 12px;
    margin-top: 5px;
}

.submit-row {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid #ddd;
}

.submit-row input[type="submit"] {
    background-color: #417690;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-right: 10px;
}

.submit-row .cancel-link {
    background-color: #6c757d;
    color: white;
    padding: 10px 20px;
    text-decoration: none;
    border-radius: 4px;
    display: inline-block;
}

.submit-row .cancel-link:hover {
    background-color: #5a6268;
    color: white;
}
</style>
{% endblock %}
